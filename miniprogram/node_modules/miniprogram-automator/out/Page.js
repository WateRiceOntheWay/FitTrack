"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const Element_1=__importDefault(require("./Element")),isStr_1=__importDefault(require("licia/isStr")),isNum_1=__importDefault(require("licia/isNum")),sleep_1=__importDefault(require("licia/sleep")),waitUntil_1=__importDefault(require("licia/waitUntil")),isFn_1=__importDefault(require("licia/isFn"));class Page{constructor(t,e){this.path="",this.query={},this.elementMap=new Map,this.connection=t,this.id=e.id,this.path=e.path,this.query=e.query}async waitFor(t){isNum_1.default(t)?await sleep_1.default(t):isFn_1.default(t)?await waitUntil_1.default(t):isStr_1.default(t)&&await waitUntil_1.default((async()=>(await this.$$(t)).length>0))}async $(t){try{const e=await this.send("Page.getElement",{selector:t});return Element_1.default.create(this.connection,Object.assign(Object.assign({},e),{pageId:this.id}),this.elementMap)}catch(t){return null}}async $$(t){const{elements:e}=await this.send("Page.getElements",{selector:t});return e.map((t=>Element_1.default.create(this.connection,Object.assign(Object.assign({},t),{pageId:this.id}),this.elementMap)))}async getElementByXpath(t){try{const e=await this.send("Page.getElementByXpath",{selector:t});return Element_1.default.create(this.connection,Object.assign(Object.assign({},e),{pageId:this.id}),this.elementMap)}catch(t){return null}}async getElementsByXpath(t){const{elements:e}=await this.send("Page.getElementsByXpath",{selector:t});return e.map((t=>Element_1.default.create(this.connection,Object.assign(Object.assign({},t),{pageId:this.id}),this.elementMap)))}async xpath(t){return this.getElementByXpath(t)}async data(t){const e={};return t&&(e.path=t),(await this.send("Page.getData",e)).data}async setData(t){await this.send("Page.setData",{data:t})}async size(){const[t,e]=await this.windowProperty(["document.documentElement.scrollWidth","document.documentElement.scrollHeight"]);return{width:t,height:e}}async callMethod(t,...e){return(await this.send("Page.callMethod",{method:t,args:e})).result}async scrollTop(){const t=await this.windowProperty("document.body.scrollTop"),e=await this.windowProperty("document.documentElement.scrollTop");return t||e}async windowProperty(t){let e;e=isStr_1.default(t)?[t]:t;const a=(await this.send("Page.getWindowProperties",{names:e})).properties;return isStr_1.default(t)?a[0]:a}async send(t,e={}){return e.pageId=this.id,await this.connection.send(t,e)}static create(t,e,a){if(a.get(e.id))return a.get(e.id);const i=new Page(t,e);return a.set(e.id,i),i}}exports.default=Page;